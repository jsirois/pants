# GENERATED, DO NOT EDIT!
# To change, edit `build-support/bin/generate_travis_yml.py` and run:
#   ./pants run build-support/bin:generate_travis_yml > .travis.yml


conditions: v1
deploy:
  'on':
    all_branches: true
    condition: $PREPARE_DEPLOY = 1
    repo: pantsbuild/pants
  provider: script
  script: ./build-support/bin/deploy_to_s3.py
  skip_cleanup: true
env:
  global:
  - PANTS_CONFIG_FILES="${TRAVIS_BUILD_DIR}/pants.travis-ci.toml"
  - LC_ALL="en_US.UTF-8"
  - AWS_BUCKET=ci-public.pantsbuild.org
  - BOOTSTRAPPED_PEX_KEY_PREFIX=daily/${TRAVIS_BUILD_NUMBER}/${TRAVIS_BUILD_ID}/pants.pex
  - NATIVE_ENGINE_SO_KEY_PREFIX=monthly/native_engine_so
  - PYENV_PY27_VERSION=2.7.18
  - PYENV_PY36_VERSION=3.6.10
  - PYENV_PY37_VERSION=3.7.7
  - PYENV_PY38_VERSION=3.8.3
  - PYENV_ROOT_OSX=${HOME}/.pants_pyenv
  - PYENV_ROOT="${PYENV_ROOT:-${PYENV_ROOT_OSX}}"
  - PATH="${PYENV_ROOT}/shims:${PATH}"
  - AWS_CLI_ROOT="${HOME}/.aws_cli"
  - AWS_ACCESS_KEY_ID__TO_BE_REEXPORTED_ON_DEPLOYS=AKIAV6A6G7RQWPRUWIXR
  - secure: hFVAQGLVkexzTd3f9NF+JoG1dE+CPICKqOcdvQYv8+YB2rwwqu0/J6MnqKUZSmec4AM4ZvyPUBIHnSw8aMJysYs+GZ6iG/8ZRRmdbmo2WBPbSZ+ThRZxx/F6AjmovUmf8Zt366ZAZXpc9NHKREkTUGl6UL7FFe9+ouVnb90asdw=
  - RUST_BACKTRACE="all"
jobs:
  include:
  - addons:
      apt:
        packages:
        - lib32stdc++6
        - lib32z1
        - lib32z1-dev
        - gcc-multilib
        - python-dev
        - openssl
        - libssl-dev
        - jq
        - unzip
        - shellcheck
    after_failure:
    - ./build-support/bin/ci-failure.sh
    before_install:
    - ./build-support/bin/install_aws_cli_for_ci.sh
    - pyenv global 2.7.15 3.6.7 3.7.1
    dist: xenial
    env:
    - CACHE_NAME=integration.v2.py36
    language: python
    name: Integration tests - V2 (Python 3.6)
    os: linux
    python:
    - '2.7'
    - '3.6'
    - '3.7'
    script:
    - pyenv global
    - pyenv versions --bare | xargs pyenv prefix
    - which -a python2.7
    - which -a python3.6
    - which -a python3.7
    stage: Test Pants
    sudo: required
  - addons:
      apt:
        packages:
        - lib32stdc++6
        - lib32z1
        - lib32z1-dev
        - gcc-multilib
        - python-dev
        - openssl
        - libssl-dev
        - jq
        - unzip
        - shellcheck
    after_failure:
    - ./build-support/bin/ci-failure.sh
    before_install:
    - ./build-support/bin/install_aws_cli_for_ci.sh
    - pyenv global 2.7.15 3.6.7 3.7.1
    dist: xenial
    env:
    - CACHE_NAME=integration.v2.py37
    language: python
    name: Integration tests - V2 (Python 3.7)
    os: linux
    python:
    - '2.7'
    - '3.6'
    - '3.7'
    script:
    - pyenv global
    - pyenv versions --bare | xargs pyenv prefix
    - which -a python2.7
    - which -a python3.6
    - which -a python3.7
    stage: Test Pants (Cron)
    sudo: required
stages:
- if: type != cron
  name: Bootstrap Pants
- if: type = cron
  name: Bootstrap Pants (Cron)
- if: type != cron
  name: Test Pants
- if: type = cron
  name: Test Pants (Cron)
- if: tag IS present AND tag =~ ^release_.*$
  name: Deploy Pants Pex
- if: tag IS NOT present AND type NOT IN (pull_request, cron)
  name: Deploy Pants Pex Unstable

